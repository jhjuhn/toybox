<!DOCTYPE HTML>
<html>
<head>
<link href = 'https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel = 'stylesheet' type = 'text/css'>
<style>
html, body {
	margin: 0; padding: 0;
	background-color: #000;
	color: #999;

	font-family: 'open sans', sans-serif;
	font-size: 14px;
}
h2 { font-size: 18px; }

/*UI*/

#container {
	width: 720px;
	margin: 4px auto;
}
#credits{
	margin-top: 16px;
	font-size: 12px;
}

/* WORLD*/

#world {
	border: 1px #ccc none;/*dashed;*/

	margin: 4px auto;

	position: relative;

	width: 720px;
	height: 720px;

	/*overflow: hidden;*/
}

</style>

<script id="vsh" type="text/glsl">#version 300 es
in vec2 x;
void main() {
	gl_Position = vec4(x, 0., 1.); }
</script>

<script id="fsh" type="text/glsl">#version 300 es
#define PI 3.1415926536

precision mediump float;

uniform float t;

uniform float ampl;
uniform float lamb;
uniform float omeg;
uniform float symm;

out vec4 frag_color;

float v;

float wave (float angle, vec2 q, float t) {
	float x = dot(q, vec2(cos(angle), sin(angle)));
	return sin(omeg*(x/v + t));
}

float f (vec2 q, float t) {
	float ret = 0.;
	for (float i = 0.; i < symm; i += 1.) {
		ret = ret + ampl/symm*wave(-PI/symm*i, q, t);
	}
	return ret;
}

/* palette parameters */
vec3 pa = vec3(0.5, 0.5, 0.5);
vec3 pb = vec3(0.5, 0.5, 0.5);
vec3 pc = vec3(1.0, 1.0, 0.0);
vec3 pd = vec3(0.5, 0.7, 0.18);

vec4 palette (float arg) {
	/* -1 to 1, wrap around if out of bounds */
	arg = sin(.5*PI*arg);
	
	vec3 col = pa + pb*cos(2.*PI*(pc*arg+pd));
	return vec4(col, 1.);

//	return vec4(arg, -arg, abs(arg), 1.);
	
}

void main() {

	v = omeg*lamb/2./PI;
	vec2 q = gl_FragCoord.xy/720.-vec2(0.5, 0.5);

	frag_color = palette(f(q, t));
}
</script>

</head>
<body>

<div id = "container">
	<h2>TITLE</h2>

	<canvas id = "world" width = "720" height = "720"></canvas>
	<script src="../shared/gl.js"></script>
	<script>
let g = new GL(document.getElementById("world"));

g.makeShader("v", document.getElementById("vsh").text, g.gl.VERTEX_SHADER);
g.makeShader("f", document.getElementById("fsh").text, g.gl.FRAGMENT_SHADER);
g.makeProgram("p", g.sh.v, g.sh.f);

const x = new Float32Array([1, 1, -1, 1, 1, -1, -1, -1]);

g.makeAttributeBuffer(g.prg.p, "x", 2, g.gl.FLOAT);
g.setAttributeBuffer(g.prg.p, "x", x);

g.makeUniform(g.prg.p, "t", "1f");
g.makeUniform(g.prg.p, "ampl", "1f");
g.makeUniform(g.prg.p, "lamb", "1f");
g.makeUniform(g.prg.p, "omeg", "1f");
g.makeUniform(g.prg.p, "symm", "1f");

let ampl = 1.0;
let lamb = 0.05;
let omeg = 0.4 * 2 * Math.PI;
let symm = 5.0;

function modifyUniforms ()
{
	g.setUniform(g.prg.p, "ampl", ampl);
	g.setUniform(g.prg.p, "lamb", lamb);
	g.setUniform(g.prg.p, "omeg", omeg);
	g.setUniform(g.prg.p, "symm", symm);
}

function timestep (t)
{
	window.requestAnimationFrame(timestep);

	g.setUniform(g.prg.p, "t", t*1e-3);
	modifyUniforms();
	g.render(g.prg.p, g.gl.TRIANGLE_STRIP);

}
window.requestAnimationFrame(timestep);
	
	
	</script>
	
	<div><p>description.</p></div>

	<div id = "credits">
	J. Lo, [M] [yyyy].
	</div>

</div>

</body>
</html>
