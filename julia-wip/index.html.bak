<!DOCTYPE HTML>
<html>
<head>
<link href = 'https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel = 'stylesheet' type = 'text/css'>
<style>
html, body {
	margin: 0; padding: 0;
	background-color: #fff;
	color: #999;

	font-family: 'open sans', sans-serif;
	font-size: 14px;
}
h2 { font-size: 18px; }

/*UI*/

#container {
	width: 720px;
	margin: 4px auto;
}
#credits{
	margin-top: 16px;
	font-size: 12px;
}

/* WORLD*/

#world {
	border: 1px #ccc none;/*dashed;*/

	margin: 4px auto;

	position: relative;

	width: 720px;
	height: 720px;

	/*overflow: hidden;*/
}

</style>

<script id = "vsh" type = "text/GLSL">
precision mediump float;

attribute vec2 x;

varying vec2 tex_x;

void main ()
{
	tex_x = x;
	gl_Position = vec4(x, 0., 1.);
}
</script>
<script id = "fsh" type = "text/GLSL">
precision mediump float;

varying vec2 tex_x;

vec2 mul (vec2 z1, vec2 z2)
{
	return vec2(
		z1.x*z2.x-z1.y*z2.y,
		z1.x*z2.y+z2.x*z1.y);
}

vec2 f (vec2 z, vec2 c)
{
	return mul(z, z)+c;
}

void main ()
{
	vec2 c = tex_x*2.;
	vec2 z = vec2(0., 0.);

	vec4 frag_color;

	int iter = 100;
	float cutoff = 4.;

	for (int i = 0; i < 100; ++i) {
		z = f(z, c);
	}

	if (length(z) > cutoff) {
		frag_color = vec4(0., 0., 0., 1);
	} else {
		frag_color = vec4(1., 1., 1., 1);
	}

	gl_FragColor = frag_color;
}
</script>

</head>
<body>

<div id = "container">
	<h2>TITLE</h2>

	<canvas id = "world" width = "720" height = "720"></canvas>
	<script>

		function makeShader (gl, type, src)
		{
			const sh = gl.createShader(type);
			gl.shaderSource(sh, src);
			gl.compileShader(sh);
			if (gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {
				return sh;
			}

			console.log(gl.getShaderInfoLog(sh));
			gl.deleteShader(sh);
		}

		function makeProgram (gl, vsh, fsh)
		{
			const prg = gl.createProgram();
			gl.attachShader(prg, vsh);
			gl.attachShader(prg, fsh);
			gl.linkProgram(prg);
			if (gl.getProgramParameter(prg, gl.LINK_STATUS)) {
				return prg;
			}

			console.log(gl.getProgramInfoLog(prg));
			gl.deleteProgram(prg)
		}

		function init ()
		{
			const canvas = document.getElementById("world");
			const gl = canvas.getContext("webgl2");

			if (!gl) {
				console.log('no webgl2 support.');
			}

			const vsh = makeShader(
				gl,	gl.VERTEX_SHADER,
				document.getElementById("vsh").text);

			const fsh = makeShader(
				gl, gl.FRAGMENT_SHADER,
				document.getElementById("fsh").text);
		
			const prg = makeProgram(gl, vsh, fsh);
			gl.useProgram(prg);


			const x_data = new Float32Array([
				 1,  1,
				 1, -1,
				-1,  1,
				-1, -1]);

			const x_loc = gl.getAttribLocation(prg, "x");
			const x_buf = gl.createBuffer();
			gl.bindBuffer(gl.ARRAY_BUFFER, x_buf);

			gl.enableVertexAttribArray(x_loc);

			gl.vertexAttribPointer(x_loc, 2, gl.FLOAT, false, 0, 0);
			gl.bufferData(gl.ARRAY_BUFFER, x_data, gl.STATIC_DRAW);


			gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

			return {
				gl: gl,
				a_loc: {
					'x':	x_loc},
				a_buf: {
					'x':	x_buf},
			};

		}

		function render (gl)
		{
			gl.drawArrays(gl.TRIANGLES, 0, 3);
		}

		const state = init();
		//render(state.gl);
	</script>
	
	<div><p>description.</p></div>

	<div id = "credits">
	J. Lok, [M] [yyyy].
	</div>

</div>


</body>

</html>
