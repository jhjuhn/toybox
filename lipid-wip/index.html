<!DOCTYPE HTML>
<html>
<head>
<link href = 'https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel = 'stylesheet' type = 'text/css'>
<style>
html, body {
	margin: 0; padding: 0;
	background-color: #fff;
	color: #999;

	font-family: 'open sans', sans-serif;
	font-size: 14px;
}
h2 { font-size: 18px; }

/*UI*/

#container {
	width: 720px;
	margin: 4px auto;
}
#credits{
	margin-top: 16px;
	font-size: 12px;
}

#pool {
	width: 720px;
	height: 720px;
}

</style>

</head>
<body>

<div id = "container">
	<h2>LIPID</h2>

	<canvas id = "pool"></canvas>
<script>
// SIMPLE 2-VECTOR LIBRARY
var Vector2 = function(x, y){ this.x = x; this.y = y; }
Vector2.prototype = {
	x: 0, y: 0,
	set: function(x, y) {
		if (x.x !== undefined) { this.x = x.x, this.y = x.y; }
		else { this.x = x, this.y = y; }
	},
	add: function(v, w) {
		if (v.x !== undefined) { this.x += v.x; this.y += v.y; }
		else { this.x += v, this.y += w; }
		return this;
	},
	sub: function(v, w) {
		if (v.x !== undefined) { this.x -= v.x; this.y -= v.y; }
		else { this.x -= v, this.y -= w; }
		return this;
	},
	mul: function(a) { this.x *= a; this.y *= a; return this; },
	div: function(a) { this.x /= a; this.y /= a; return this; },
	mag: function() { return Math.sqrt(this.x*this.x+this.y*this.y); },
	unit: function() { return this.div(this.mag()); },
	clone: function() { return new Vector2(this.x, this.y); }
};
var V2 = {
	add: function(u, v) { return new Vector2(u.x+v.x, u.y+v.y); },
	sub: function(u, v) { return new Vector2(u.x-v.x, u.y-v.y); },
	mul: function(a, u) { return new Vector2(a*u.x, a*u.y); },
	div: function(a, u) { return new Vector2(u.x/a, u.y/a); },
	unit: function(u) { return u.clone().unit(); }
};
</script>

<script>
var Particle = function(x, y, m){
	this.m = 1;
	this.q = new Vector2(x, y);
	this.prev_q = new Vector2(x, y);

	this.f = new Vector2(0, 0);
}
Particle.prototype = {

	integrate: function(dt){
		var new_q = this.q.clone().mul(2).sub(this.prev_q).add(
			V2.mul(this.m*dt*dt, this.f));
		this.prev_q = this.q;
		this.q = new_q;

		this.f.set(0, 0);
	}
};

var Lipid = function(x, y, thet){
	this.head = new Particle(x, y, 1);
	this.tail = new Particle(
		this.head.q.x+this.l*Math.cos(thet),
		this.head.q.y+this.l*Math.sin(thet),
		1);
}
Lipid.prototype = {
	l: 12,
	r: 2.2,

	integrate: function(dt){
		// move individual ends
		this.head.integrate(dt);
		this.tail.integrate(dt);

		// solve length constraint
		
		var d = V2.sub(this.head.q, this.tail.q);
		var p = (d.mag()-this.l)/2;
		d.unit();

		
		this.head.q.sub(V2.mul(p, d));
		this.tail.q.add(V2.mul(p, d));
		
	},
	draw: function(ctx){
		ctx.beginPath();
		ctx.arc(this.head.q.x, this.head.q.y,
		this.r, 0, 2*Math.PI);
		ctx.fill();

		ctx.beginPath();
		ctx.moveTo(this.head.q.x, this.head.q.y);
		ctx.lineTo(this.tail.q.x, this.tail.q.y);
		ctx.stroke();

	}
};


var Pool = function(L, dt){
	this.lipids = [];

	this.L = L;
	this.dt = dt;

	this.canv = document.getElementById('pool');
	this.canv.width = this.canv.height = this.L;
	this.ctx = this.canv.getContext('2d');
}
Pool.prototype = {
	addLipid: function(x, y, thet){
		this.lipids.push(new Lipid(x, y, thet));
	},
	addRandomLipids: function(n) {
		for (var i = 0; i < n; ++i) {
			this.addLipid(
			Math.random()*this.L,
			Math.random()*this.L,
			Math.random()*2*Math.PI
			);
		}
	},
	integrate: function(){
		for (var i = 0; i < this.lipids.length; ++i) {
			this.lipids[i].integrate(this.dt);
		}
	},
	forces: function(){
		for (var i = 0; i < this.lipids.length; ++i) {
			this.lipids[i].head.f.set(
				6*Math.random()-3,
				6*Math.random()-3);
			this.lipids[i].tail.f.set(
				6*Math.random()-3,
				6*Math.random()-3);
		}
	},
	render: function(){
		this.ctx.clearRect(0, 0, this.canv.width, this.canv.height);
		for (var i = 0; i < this.lipids.length; ++i) {
			this.lipids[i].draw(this.ctx);
		}
	},
	timestep: function(){
		this.forces();
		this.integrate();
		this.render();
	},
	run: function(){
		this.timestep();
		window.requestAnimationFrame(this.run.bind(this));
	}
}

var pool = new Pool(720, 0.05);
pool.addRandomLipids(10);

pool.run();


</script>

	<div><p>description.</p></div>

	<div id = "credits">
	J. Lok, [M] [yyyy].
	</div>

</div>


</body>

</html>
